/**
 * Created by laurent on 18/10/2014.
 */
'use strict';

var aroundevApp = angular.module('aroundevApp', [
    'ngRoute',
    'pascalprecht.translate',
    'ngCookies'
]);

aroundevApp.config(["$routeProvider", "$translateProvider", "$locationProvider", function($routeProvider, $translateProvider, $locationProvider){
    //Routing
    $routeProvider.
        when('/', {templateUrl: '/app/js/index/html/index.html'})
        .when('/login', {templateUrl: '/app/js/user/html/login.html'});
    $locationProvider.html5Mode(true);//Remove the '#' on the url

    //Translate
    $translateProvider.useStaticFilesLoader({
        prefix: '/app/js/languages/json/',
        suffix: '.json'
    });
    $translateProvider.useCookieStorage();
    $translateProvider.preferredLanguage('en');
}]);
/**
 * Created by laurent on 18/10/2014.
 */
aroundevApp.controller('translateCtrl', ["$scope", "$translate", "$cookies", function($scope, $translate, $cookies) {
    $scope.en = false;
    $scope.fr = false;
    var currentLanguage = $cookies.NG_TRANSLATE_LANG_KEY;
    if(currentLanguage === '"en"'){
        $scope.en = true;
    }else if(currentLanguage === '"fr"'){
        $scope.fr = true;
    }else{
        $scope.en = true;
    }
    $scope.changeLanguage = function (langKey){
        $translate.use(langKey);
        $scope.en = false;
        $scope.fr = false;
        if(langKey === 'en'){
            $scope.en = true;
        }else if(langKey === 'fr'){
            $scope.fr = true;
        }else{
            $scope.en = true;
        }
    };
}]);
/**
 * Created by laurent on 19/10/2014.
 */
'use strict';

aroundevApp.controller('menuCtrl', ["$scope", "$translate", "$http", "$location", function($scope, $translate, $http, $location) {
    $scope.logOut = function(){
        $http.get('logout')
            .success(function(data, status, headers, config){
                toastr.success($translate.instant('LOGIN_LOG_OUT_SUCCESS'));
                window.location.reload();
            }).error(function(data, status, headers, config){
                toastr.error($translate.instant('LOGIN_LOG_OUT_FAILED'));
            });
    };
}]);
/**
 * Created by laurent on 19/10/2014.
 */
'use strict';

aroundevApp.controller('userCtrl', ["$scope", "$translate", "$http", "$location", function($scope, $translate, $http, $location) {
    $scope.logIn = function(){
        var data = "login="+$scope.login+"&password="+$scope.password;
        $http.post('login', data, {
            headers: {
                'Content-Type': 'application/x-www-form-urlencoded'
            }
        }).
            success(function(data, status, headers, config) {
                toastr.success($translate.instant('LOGIN_LOG_IN_SUCCESS'));
                $location.path('/');
                window.location.reload();
            }).
            error(function(data, status, headers, config){
                toastr.error($translate.instant('LOGIN_LOG_IN_FAILED'));
                $location.path('/login');
            });
    };
}]);