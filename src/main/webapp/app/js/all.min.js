angular.module("aroundev",["ngAnimate","ui.bootstrap","aroundev.service.auth","aroundev.translate","aroundev.menu","aroundev.index","aroundev.user","aroundev.events"]).config(["$translateProvider","$locationProvider",function(n,e){e.html5Mode(!0)}]).constant("roles",{authenticated:"AUTHENTICATED",admin:"ADMIN",user:"USER"}).run(["authService","$location","$rootScope","$state",function(n,e,t,o){t.$on("$stateChangeStart",function(e,t){_.isEmpty(t.hasRoles)||n.hasRoles(t.hasRoles).then(function(n){n||(o.transitionTo("login"),e.preventDefault())},function(){}),_.isEmpty(t.hasNotRoles)||n.hasRoles(t.hasNotRoles).then(function(n){n&&(o.transitionTo("index"),e.preventDefault())},function(){})})}]),angular.module("aroundev.service.auth",["pascalprecht.translate","restangular","aroundev.service.utils"]).config(["RestangularProvider",function(){}]).service("authService",["$translate","$http","$location","Restangular","$q","toastr","utilsService",function(n,e,t,o,r,i,a){this.login=function(n,e){return r(function(t,r){o.one("login").customPOST("login="+n+"&password="+e,void 0,void 0,{"Content-Type":"application/x-www-form-urlencoded"}).then(function(){t(!0)},function(){r(!1)})})},this.logout=function(){return r(function(e,t){o.one("logout").get().then(function(){window.location.reload(),e(result)},function(){i.error(n.instant("LOGIN_LOG_OUT_FAILED")),t(!1)})})},this.getProfile=function(){return r(function(n,e){_.isEmpty(window.user.roles)?o.one("api/user/currentProfil").get().then(function(t){if(_.isUndefined(t.type)||"NotConnected"!=t.type){var o=[];_.forEach(t.roles,function(n){o.push(n)}),window.user={username:t.login,roles:o},n(window.user)}else e(t)},function(){e(!1)}):n(window.user)})},this.hasRoles=function(n){return r(function(e){_.isEmpty(window.user.roles)?e(!1):e(a.containMoreThanOne(user.roles,n))})},this.getUser=function(){return _.isEmpty(window.user.roles)?!1:window.user},this.signIn=function(n){return r(function(e,t){o.one("api").post("user",n).then(function(n){e(n)},function(){t(!1)})})},this.loginExist=function(n){return r(function(e,t){o.one("api/user/exist/login").one(n).get().then(function(n){e(n)},function(){t(!1)})})},this.emailExist=function(n){return r(function(e,t){var r={email:n};o.one("api/user/exist").post("email",r).then(function(n){e(n)},function(){t(!1)})})},this.supinfoIdExist=function(n){return r(function(e,t){o.one("api/user/exist/supinfoId").one(n).get().then(function(n){e(n)},function(){t(!1)})})}}]),angular.module("aroundev.service.events",["restangular"]).service("eventsService",["$translate","$http","$location","Restangular","$q","toastr","utilsService",function(n,e,t,o,r){this.create=function(n){return r(function(e,t){o.one("api").post("events",n).then(function(n){e(n)},function(){t(!1)})})},this.findAll=function(){return r(function(n,e){o.one("api").one("events").get().then(function(e){n(e)},function(){e(!1)})})}}]),angular.module("aroundev.service.utils",[]).service("utilsService",function(){this.errorMessage={containMoreThanOne_Parameters:"More than one of parameters are not an array"},this.containMoreThanOne=function(n,e){if(!_.isArray(n)||!_.isArray(e))return this.errorMessage.containMoreThanOne_Parameters;var t=!1;return _.forEach(e,function(e){_.contains(n,e)&&(t=!0)}),t}}),angular.module("aroundev.events",["aroundev.events.modal.new","ui.bootstrap","ui.router","toastr","aroundev.service.events"]).config(["$stateProvider",function(n){n.state("events",{url:"/events",templateUrl:"/app/js/modules/events/view/events.html",controller:"eventsCtrl",hasRoles:["AUTHENTICATED"],hasNotRoles:[]})}]).controller("eventsCtrl",["$scope","$modal","eventsService","toastr","$translate",function(n,e,t,o,r){n.oneAtATime=!0,n.events=[],t.findAll().then(function(e){n.events=e},function(){return o.error(r.instant("COMMON_ERROR")),!1}),n.openNewEventModal=function(){e.open({templateUrl:"newEventModal.html",controller:"newEventModalCtrl"}).result.then(function(){t.findAll().then(function(e){n.events=e},function(){return o.error(r.instant("COMMON_ERROR")),!1})},function(){})}}]),angular.module("aroundev.events.modal.new",["ui.bootstrap","aroundev.service.events"]).controller("newEventModalCtrl",["$scope","$modalInstance","eventsService","toastr","$translate",function(n,e,t,o,r){n.create=function(i){n.createEventLoading=!0;var a=angular.copy(i);a.startdate=new Date(i.startdate).getTime(),t.create(a).then(function(){n.createEventLoading=!1,e.close()},function(){n.createEventLoading=!1,o.error(r.instant("COMMON_ERROR"))})},n.cancel=function(){e.dismiss("cancel")},n.open=function(e){e.preventDefault(),e.stopPropagation(),n.opened=!0}}]),angular.module("aroundev.index",["ui.router"]).config(["$stateProvider","$urlRouterProvider",function(n){n.state("index",{url:"/",templateUrl:"/app/js/modules/index/view/index.html",controller:"indexCtrl",authenticate:!1,hasRoles:[],hasNotRoles:[]})}]).controller("indexCtrl",["$scope",function(n){n.pageClass="indexPageClass"}]),angular.module("aroundev.translate",["aroundev.service.auth","pascalprecht.translate","ngCookies"]).config(["$translateProvider",function(n){n.useStaticFilesLoader({prefix:"/app/js/modules/languages/json/",suffix:".json"}),n.useCookieStorage(),n.preferredLanguage("en")}]).controller("translateCtrl",["$scope","$translate","$cookies","configs",function(n,e,t,o){n.translateAllowed=o.translateAllowed,o.translateAllowed||(t.NG_TRANSLATE_LANG_KEY=o.defaultLanguage),n.en=!1,n.fr=!1;var r=t.NG_TRANSLATE_LANG_KEY;'"en"'===r?n.en=!0:'"fr"'===r?n.fr=!0:n.en=!0,n.changeLanguage=function(t){e.use(t),n.en=!1,n.fr=!1,"en"===t?n.en=!0:"fr"===t?n.fr=!0:n.en=!0}}]),angular.module("aroundev.menu",["aroundev.service.auth"]).controller("menuCtrl",["$scope","authService","$rootScope","$location",function(n,e,t,o){t.$on("user:logged",function(e,t){n.activeConnectedMode(t)}),n.logged=!1,n.activeConnectedMode=function(e){n.logged=!0,n.username=e.login},n.logOut=function(){e.logout()},n.isActive=function(n){return new RegExp(n).test(o.path())}}]).directive("menu",["authService",function(n){return{scope:!0,restrict:"E",controller:"menuCtrl",replace:!0,templateUrl:"/app/js/modules/menu/view/menu.html",link:function(e){var t=n.getUser();t&&e.activeConnectedMode(t)}}}]),angular.module("aroundev.user",["aroundev.user.login","aroundev.user.signin"]),angular.module("aroundev.user.login",["aroundev.service.auth","pascalprecht.translate","ui.router","toastr"]).config(["$stateProvider","$urlRouterProvider",function(n){n.state("login",{url:"/login",templateUrl:"/app/js/modules/user/view/login.html",controller:"loginCtrl",hasRoles:[],hasNotRoles:["AUTHENTICATED"]})}]).constant("localConfig",{connexionLatence:1e3}).controller("loginCtrl",["$translate","$scope","authService","$interval","$location","$rootScope","localConfig","toastr","$state",function(n,e,t,o,r,i,a,s,u){e.chrono=void 0,e.pageClass="loginPageClass",e.logIn=function(){e.progressBarLogin=!0,e.progressBarValue=20,e.chrono=o(function(){t.login(e.login,e.password).then(function(){e.progressBarValue=60,t.getProfile().then(function(n){e.loginSuccess(n)},function(){e.loginFailed()})},function(){e.loginFailed()})},a.connexionLatence,1)},e.resetProgressBar=function(){e.progressBarLogin=!1,e.progressBarValue=0,e.progressBarType=""},e.loginCtrlFieldsUpdated=function(){o.cancel(e.chrono),e.resetProgressBar()},e.loginFailed=function(){s.error(n.instant("LOGIN_LOG_IN_FAILED")),e.progressBarValue=100,e.progressBarType="progress-bar-danger",e.chrono=o(function(){return e.resetProgressBar()},4e3,1)},e.loginSuccess=function(t){e.progressBarValue=100,e.progressBarType="progress-bar-success",e.chrono=o(function(){s.success(n.instant("LOGIN_LOG_IN_SUCCESS")),i.$emit("user:logged",t),u.transitionTo("index"),e.resetProgressBar()},a.connexionLatence,1)}}]),angular.module("aroundev.user.signin",["aroundev.service.auth","pascalprecht.translate","toastr","ui.router","angular-ladda"]).config(["$stateProvider",function(n){n.state("signin",{url:"/signin",templateUrl:"/app/js/modules/user/view/signin.html",controller:"signinCtrl",authenticate:!1,hasRoles:[],hasNotRoles:["AUTHENTICATED"]})}]).controller("signinCtrl",["$scope","authService","toastr","$translate","$state","$interval",function(n,e,t,o,r,i){n.signIn=function(a){if(n.signinForm.$invalid)n.onSignInErrorNotFilled="animated flash",i(function(){n.onSignInErrorNotFilled=""},1e3,1),t.error(o.instant("SIGNIN_ERROR_NOT_FULL_FILLED"));else{n.signInLoading=!0;var s=angular.copy(a);e.signIn(s).then(function(){t.success(o.instant("SIGNIN_SUCCESS_REGISTRATION")),n.signInLoading=!1,r.transitionTo("login")},function(){t.error(o.instant("SIGNIN_ERROR_REGISTRATION")),n.signInLoading=!1,r.transitionTo("index")})}}}]).directive("passwordConfirmationValidation",function(){return{require:"ngModel",link:function(n,e,t,o){o.$validators.passwordValidation=function(e){return o.$isEmpty(e)?!1:e==n.newUser.password?!0:!1}}}}).directive("loginValidation",["authService","toastr","$translate","$q",function(n,e,t,o){return{require:"ngModel",link:function(r,i,a,s){s.$asyncValidators.loginValidation=function(r,i){var a=r||i;return n.loginExist(a).then(function(n){return n?(e.error(t.instant("SIGNIN_ERROR_LOGIN_EXIST")),o.reject("already exists")):!0},function(){e.error(t.instant("COMMON_ERROR")),o.reject("error")})}}}}]).directive("supinfoIdValidation",["authService","toastr","$translate","$q",function(n,e,t,o){return{require:"ngModel",link:function(r,i,a,s){s.$asyncValidators.supinfoIdValidation=function(r,i){var a=r||i;return n.supinfoIdExist(a).then(function(n){return n?(e.error(t.instant("SIGNIN_ERROR_SUPINFO_ID_EXIST")),o.reject("already exists")):!0},function(){o.reject("error"),e.error(t.instant("COMMON_ERROR"))})}}}}]).directive("integerValidation",["authService","toastr","$translate","$q",function(){return{require:"ngModel",link:function(n,e,t,o){var r=/^\-?\d+$/;o.$validators.integerValidation=function(n,e){return o.$isEmpty(n)?!0:r.test(e)?!0:!1}}}}]).directive("emailValidation",["authService","toastr","$translate","$q",function(n,e,t,o){return{require:"ngModel",link:function(r,i,a,s){s.$asyncValidators.emailValidation=function(r,i){var a=r||i;return n.emailExist(a).then(function(n){return n?(e.error(t.instant("SIGNIN_ERROR_EMAIL_EXIST")),o.reject("already exists")):!0},function(){e.error(t.instant("COMMON_ERROR")),o.reject("error")})}}}}]);