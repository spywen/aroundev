/**
 * Created by laurent on 18/10/2014.
 */
'use strict';

angular.module('aroundev', [
    'ngRoute',
    'ngAnimate',
    'aroundev.translate',
    'aroundev.menu',
    'aroundev.index',
    'aroundev.user'
]).config(["$routeProvider", "$translateProvider", "$locationProvider", function($routeProvider, $translateProvider, $locationProvider){
    //Routing
    $routeProvider.
        when('/', {
            templateUrl: '/app/js/index/html/index.html',
            controller: 'indexCtrl'
        })
        .when('/login', {
            templateUrl: '/app/js/user/html/login.html',
            controller: 'userCtrl'
        });
    $locationProvider.html5Mode(true);//Remove the '#' on the url

    //Translate
    $translateProvider.useStaticFilesLoader({
        prefix: '/app/js/languages/json/',
        suffix: '.json'
    });
    $translateProvider.useCookieStorage();
    $translateProvider.preferredLanguage('en');
}]);
/**
 * Created by laurent on 19/10/2014.
 */
angular.module('aroundev.index', [
]).controller('indexCtrl', ["$scope", function($scope) {
    $scope.pageClass = 'indexPageClass';
}]);
/**
 * Created by laurent on 18/10/2014.
 */
angular.module('aroundev.translate', [
    'aroundev.service.auth',
    'pascalprecht.translate',
    'ngCookies'
]).controller('translateCtrl', ["$scope", "$translate", "$cookies", function($scope, $translate, $cookies) {
    $scope.en = false;
    $scope.fr = false;
    var currentLanguage = $cookies.NG_TRANSLATE_LANG_KEY;
    if(currentLanguage === '"en"'){
        $scope.en = true;
    }else if(currentLanguage === '"fr"'){
        $scope.fr = true;
    }else{
        $scope.en = true;
    }
    $scope.changeLanguage = function (langKey){
        $translate.use(langKey);
        $scope.en = false;
        $scope.fr = false;
        if(langKey === 'en'){
            $scope.en = true;
        }else if(langKey === 'fr'){
            $scope.fr = true;
        }else{
            $scope.en = true;
        }
    };
}]);
/**
 * Created by laurent on 19/10/2014.
 */
angular.module('aroundev.menu', [
    'aroundev.service.auth'
]).controller('menuCtrl', ["$scope", "authService", function($scope, authService) {
    $scope.logOut = function(){
        authService.logout();
    };
}]);
/**
 * Created by laurent on 19/10/2014.
 */
angular.module('aroundev.user', [
    'aroundev.service.auth'
]).controller('userCtrl', ["$scope", "authService", function($scope, authService) {
    $scope.pageClass = 'loginPageClass';

    $scope.logIn = function(){
        authService.login($scope.login, $scope.password);
    };
}]);
/**
 * Created by laurent on 19/10/2014.
 */
angular.module('aroundev.service.auth', [
    'pascalprecht.translate'
]).service('authService',["$translate", "$http", "$location", function($translate, $http, $location){

    this.login = function(login,password){
        var data = "login="+login+"&password="+password;
        $http.post('login', data, {
            headers: {
                'Content-Type': 'application/x-www-form-urlencoded'
            }
        }).
        success(function(data, status, headers, config) {
            $location.path('/');
            window.location.reload();
        }).
        error(function(data, status, headers, config){
            toastr.error($translate.instant('LOGIN_LOG_IN_FAILED'));
        });
    };

    this.logout = function(){
        $http.get('logout')
            .success(function(data, status, headers, config){
                window.location.reload();
            }).error(function(data, status, headers, config){
                toastr.error($translate.instant('LOGIN_LOG_OUT_FAILED'));
            });
    };

}]);