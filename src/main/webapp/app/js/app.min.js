/* TESTS ANGULAR */
var myApp = angular.module('angularTests', []);

//TODO Configs : view injection
/*myApp.config(['$routeProvider', function ($routeProvider){
    $routeProvider
        .when('/', {
            templateUrl: 'views/main.html'
        })
        .otherwise({
            redirectTo: '/'
        });
}]);*/

//Controller : manage a specific part
myApp.controller('MainCtrl', ['$scope', 'adMath', function ($scope, adMath) {
    var test = adMath.multiplyLess2(2, 2);
    $scope.text = 'Hello, Angular fanatic ! the service result is : ' + test;
}]);
myApp.controller('ngRepeatCtrl', ['$scope', function ($scope) {
    $scope.numbers = [10, 25, 35, 45, 60, 80, 100];
    $scope.lowerBound = 42;
    // Does the Filters
    $scope.greaterThanNum = function (item) {
        return item > $scope.lowerBound;
    };
}]);
myApp.controller('bindingCtrl', ['$scope', function($scope){
    $scope.myName = '';
}]);
myApp.controller('webServiceCtrl', ['$scope', '$http', function($scope, $http){
    $scope.users = [];
    $scope.pseudoStringSearch = {};
    $scope.queryBy = '$';

    /*$scope.$watch('pseudoStringSearch', function(){
        //test
    });*/

    $http({
        method: 'GET',
        url: '/api/user'
    })
    .success(function (data, status, headers, config) {
        // données récupérées avec succès
        $scope.users = data;
    })
    .error(function (data, status, headers, config) {
        // erreur de récupération :(
    });

    $scope.delete = function (index){
      $scope.users.splice(index, 1);
    };
}]);
myApp.controller('docSourceCtrl', ['$scope', function($scope){
    $scope.docs = [
        {
            name:'vfsvp.fr',
            url:'http://vfsvp.fr/article/apprendre-angular-en-un-jour-le-guide-ultime/'
        },
        {
            name:'angular-tips.com',
            url:'http://angular-tips.com/blog/2013/08/watch-how-the-apply-runs-a-digest/'
        },
        {
            name:'angular date',
            url: 'https://docs.angularjs.org/api/ng/filter/date'
        }
    ];
}]);
myApp.controller('websocketTest',['$scope', function($scopeÒ){
    var randomData;
    $('#randomDataChart').highcharts({
        chart : {
            type : 'line',
            events : {
                load : function() {
                    randomData = undefined;
                }
            }
        },
        title : {
            text : false
        },
        xAxis : {
            type : 'datetime',
            minRange : 60 * 1000
        },
        yAxis : {
            title : {
                text : false
            }
        },
        legend : {
            enabled : false
        },
        plotOptions : {
            series : {
                threshold : 0,
                marker : {
                    enabled : false
                }
            }
        },
        series : [ {
            name : 'Data',
            data : [ ]
        } ]
    });
}]);

//Directives : manage templates
myApp.directive('adOkBtn', function(){
    return {
        restrict: 'A',
        replace: true,
        template: '<a href="" class="adOkBtn btn btn-primary btn-sm">' +
            '<i class="fa fa-send"></i> Ok' +
            '</a>',
        link: function(scope, element, attrs){

        }
    };
});
myApp.directive('adCancelBtn', function(){
    return {
        restrict: 'A',
        replace: true,
        template: '<a href="" class="adCancelBtn btn btn-default btn-sm">' +
            '<i class="fa fa-reply"></i> Annuler' +
            '</a>',
        link: function(scope, element, attrs){

        }
    };
});

//Services : business methods
myApp.service('adMath', function () {
    this.multiplyLess2 = function (x, y) {
        return x * y - 2;
    };
});

//Factories : filters
myApp.filter('reverse', function(){
   return function (input, uppercase){
       var out = '';
       for(var i = 0; i < input.length; i++){
           out = input.charAt(i) + out;
       }
       if(uppercase){
           out = out.toUpperCase();
       }
       return out;
   };
});



/**
 * Created by laurent on 11/10/2014.
 */
var aroundevApp = angular.module('aroundevApp',['pascalprecht.translate', 'ngCookies']).config(function($translateProvider){
    $translateProvider.useStaticFilesLoader({
        prefix: '/app/languages/',
        suffix: '.json'
    });
    $translateProvider.useCookieStorage();
    $translateProvider.preferredLanguage('en');
});
aroundevApp.controller('translateCtrl', function($scope, $translate, $cookies) {
    $scope.en = false;
    $scope.fr = false;
    var currentLanguage = $cookies.NG_TRANSLATE_LANG_KEY;
    if(currentLanguage === '"en"'){
        $scope.en = true;
    }else if(currentLanguage === '"fr"'){
        $scope.fr = true;
    }else{
        $scope.en = true;
    }
    $scope.changeLanguage = function (langKey){
        $translate.use(langKey);
        $scope.en = false;
        $scope.fr = false;
        if(langKey === 'en'){
            $scope.en = true;
        }else if(langKey === 'fr'){
            $scope.fr = true;
        }else{
            $scope.en = true;
        }
    };
});

/**
 * Created by laurent on 26/07/2014.
 */
var myPlanningPokerApp = angular.module('planningPoker', [
    'ui.bootstrap',
    'restangular'
])
    .config(['RestangularProvider', function(RestangularProvider) {
        RestangularProvider.setBaseUrl('/api/planningpoker/');
    }]);

myPlanningPokerApp.controller('groomingsCtrl', ['$scope', 'Restangular', function ($scope, Restangular) {
    $scope.oneAtATime = true;
    $scope.groomings = [];

    var groomingsApi = Restangular.all('grooming');

    groomingsApi.getList().then(function(groomings) {
        $scope.groomings = groomings;
    });

    $scope.newGroomingForm = function(){
        var datas = $scope.fields;
        datas.name.focus();
        var newGrooming = {id:null,name:datas.name,description:datas.description,creationdate:0,enddate:null,moderator:0,isActive:true};
        groomingsApi.post(newGrooming).then(function(){
            groomingsApi.getList().then(function(groomings) {
                $scope.groomings = groomings;
            });
            datas.name = '';
            datas.description = '';
            $scope.toggle = false;
        }, function(){
            alert("error");
        });
    };

    $scope.delete = function (index){
        $scope.groomings[index].remove().then(function(){
            $scope.groomings.splice(index, 1);
        }, function(){
            alert("error");
        });
    };


}]);
